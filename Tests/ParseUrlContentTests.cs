using DiscordBotHost.Features.Auditions.Parsers;
using DiscordBotHost.Features.ContentMonitor;

using FluentAssertions;

using System.Text.Json;

namespace Tests
{
	[TestClass]
	public class ParseUrlContentTests
	{
		private ContentChangeDetector parser;

		[TestInitialize]
		public void TestInitialize()
		{
			parser = new ContentChangeDetector();
		}

		[TestMethod]
		public void ReadContent()
		{
			var url = "https://www.theatreinchicago.com/auditions";
			var selector = ".post.post-list-item";

			var percentChange = parser.DetectDifferences(url, selector, Serilog.Log.Information, Serilog.Log.Information);
			percentChange = parser.DetectDifferences(url, selector, Serilog.Log.Information, Serilog.Log.Information);
		}

		[TestMethod]
		public void ReadOtherContent()
		{
			var url = "https://www.florentineopera.org/auditions-employment";
			var selector = ".Main-content";

			var percentChange = parser.DetectDifferences(url, selector, Serilog.Log.Information, Serilog.Log.Information);
			percentChange = parser.DetectDifferences(url, selector, Serilog.Log.Information, Serilog.Log.Information);
		}

		[TestMethod]
		public void ParseResponse()
		{
			string response = "{\"jobs\":[{\"company\":\"Hell in a Handbag Productions\",\"url\":\"industrydetail.php?AuditionID=9959\",\"name\":\"Murder, ReWrote\",\"type\":\"musical\",\"description\":\"Hell in a Handbag Productions is looking for an actor for an ensemble swing role in Murder, ReWrote, a musical parody of the the classic Angela Lansbury series from 1980\\u0027s to be presented at The Den Theatre. Candidates should have sharp comic timing, sing well, and dance skills.\",\"date\":\"\"},{\"company\":\"Myers Dinner Theatre\",\"url\":\"industrydetail.php?AuditionID=9958\",\"name\":\"The Rat Pack Lounge\",\"type\":\"play\",\"description\":\"Myers Dinner Theatre in Hillsboro, IN is seeking actors for the following roles in The Rat Pack Lounge.\",\"date\":\"\"},{\"company\":\"Opens Space Arts\",\"url\":\"industrydetail.php?AuditionID=9957\",\"name\":\"Directors, Designers, Creatives, and Crew\",\"type\":\"other\",\"description\":\"Open Space Arts, a 501(c)3 non-profit organization dedicated to combating antisemitism and homophobia, seeks talented individuals to be part of our transformative mission. We seek directors, designers, crew members, and creators passionate about using their artistic skills to challenge discriminatory beliefs and promote understanding within marginalized communities.\",\"date\":\"\"},{\"company\":\"Film Audition\",\"url\":\"industrydetail.php?AuditionID=9956\",\"name\":\"Lime Green Magazine\",\"type\":\"film\",\"description\":\"Casting Call for \\u0027Lime Green Magazine\\u0027 A Short Film Trailer A Pickle Drive-In Production. Synopsis: A Southern Gothic Gender-Queer Road Journey set in the late 80\\u0027s, early 90\\u0027s with a new original soundtrack. Production will take place in Chicago Late Summer, Early Fall 2023. Pay Rate: Non-union. Stipend will be provided for shoot.\",\"date\":\"\"},{\"company\":\"BYOT Productions\",\"url\":\"industrydetail.php?AuditionID=9955\",\"name\":\"July 2023 24-Hour Show\",\"type\":\"play\",\"description\":\"Bring Your Own Theatre (BYOT) is a platform for anyone and everyone to come and create live theater with a supportive and collaborative group of talent, regardless of experience level. Our company found its roots in the living rooms of its members and has expanded to perform at venues throughout.\",\"date\":\"\"},{\"company\":\"Theatre Above the Law\",\"url\":\"industrydetail.php?AuditionID=9954\",\"name\":\"Season Generals\",\"type\":\"play\",\"description\":\"Theatre Above the Law is very excited to be holding its season generals. Season productions include Grimm: October 9-29, End Days March 1-24, 2024, Prelude to a Kiss May 3-26, 2024. All rehearsals and performances take place at The Jarvis Square Theater 1439 W. Jarvis. Pay: Stipend varies on production.\",\"date\":\"\"},{\"company\":\"Young People\\u0027s Theatre\",\"url\":\"industrydetail.php?AuditionID=9953\",\"name\":\"Junie B. Jones The Musical\",\"type\":\"musical\",\"description\":\"Following a successful inaugural season that included two world premieres and a well-attended school matinee program, Young People\\u0027s Theatre of Chicago kick-starts its sophomore season at the Greenhouse Theater Center with the fantastically fun Junie B. Jones The Musical.\",\"date\":\"\"},{\"company\":\"Edge of the Wood Theatre\",\"url\":\"industrydetail.php?AuditionID=9952\",\"name\":\"The Minutes\",\"type\":\"play\",\"description\":\"Edge of the Wood Theatre, located in Chicago\\u0027s Edgebrook neighborhood on the northwest side, announces auditions for The Minutes by Tracy Letts on Tuesday, July 11 and Thursday, July 13 from 7-9pm. Auditions will be held in the theatre space at the Edgebrook Community Church, 6736 N Loleta Avenue.\",\"date\":\"Jul 11 - Jul 13, 2023\"},{\"company\":\"GreenMan Theatre Troupe\",\"url\":\"industrydetail.php?AuditionID=9951\",\"name\":\"Bye Bye Birdie\",\"type\":\"musical\",\"description\":\"GreenMan Theatre Troupe is pleased to announce auditions for its 2023 Fall Musical, Bye Bye Birdie. We are seeking a MULTI-ETHNIC cast of men, women and teens with fantastic singing, acting and dancing abilities to play principal and supporting roles.\",\"date\":\"\"},{\"company\":\"Babes With Blades\",\"url\":\"industrydetail.php?AuditionID=9950\",\"name\":\"The Duchess of Malfi\",\"type\":\"play\",\"description\":\"Babes With Blades Theatre Company is looking for an actor of a marginalized gender to play Antonio in our upcoming production of The Duchess of Malfi, directed by BWBTC Artistic Director Hayley Rice. While we are open to actors of all ethnicities and identities, we strongly encourage BIPOC actors.\",\"date\":\"\"},{\"company\":\"Idle Muse Theatre Company\",\"url\":\"industrydetail.php?AuditionID=9949\",\"name\":\"Jane: Abortion and the Underground\",\"type\":\"play\",\"description\":\"Jane: Abortion and the Underground by Paula Kamen is a docudrama about the \\u0027Jane\\u0027 collective in the 60s and 70s who helped over 10,000 women receive illegal but safe abortions in Chicago, never having lost a patient. This production will have an intimacy designer to support the scenes where the procedure.\",\"date\":\"\"},{\"company\":\"Steel Beam Theatre\",\"url\":\"industrydetail.php?AuditionID=9938\",\"name\":\"Variety Show\",\"type\":\"play\",\"description\":\"Come join Steel Beam Theatre on July 21 and 22 for a night of song, dance, acting, and delicious food from restaurants across St. Charles! We are soliciting actors, singers, musicians, and dancers for theatrical acts. We are seeking 8 to 10 theatrical acts such as songs, monologues, scenes, and dances.\",\"date\":\"\"},{\"company\":\"Westmont Performing Arts\",\"url\":\"industrydetail.php?AuditionID=9934\",\"name\":\"The Drowsy Chaperone\",\"type\":\"play\",\"description\":\"Westmont Performing Arts Presents The Drowsy Chaperone. Auditions on Monday, June 26, 6-9pm, Thursday, June 29, 6-9pm, Sunday July 2, 1-4pm at the Westmont Park District, 75 E Richmond Street, Westmont, IL. We are also looking for help with set, costumes, lights, sound, crew and publicity. We welcome people at all levels of experience.\",\"date\":\"Jun 26 - Jul 2, 2023\"}]}";
				
				//"{\"jobs\":[{\"company\":\"The Florentine Opera\",\"url\":\"/s/FOC-Costume-Shop-Manager-Job-Posting_6_14_23.pdf\",\"name\":\"Costume Shop Manager\",\"type\":\"other\",\"description\":\"The Florentine Opera is an equal opportunity employer with a strong commitment to diversity and inclusion. We prohibit discrimination on all legally protected status. Applications by members of all underrepresented groups are encouraged.\",\"date\":\"Not specified\"},{\"company\":\"The Florentine Opera\",\"url\":\"N/A\",\"name\":\"Baumgartner Studio Artist Residency\",\"type\":\"singer\",\"description\":\"The Baumgartner Studio Artist Residency is a season-long comprehensive artist-in-residence program for singers beginning their professional careers. The Florentine Opera will announce auditions for our 2024/25 season in Fall 2023.\",\"date\":\"Fall 2023\"},{\"company\":\"The Florentine Opera\",\"url\":\"N/A\",\"name\":\"Summer Studio Ensemble\",\"type\":\"singer\",\"description\":\"The Summer Studio Ensemble is an 8-week program for singers. The Florentine Opera will announce auditions for Summer 2024 in Fall 2023.\",\"date\":\"Fall 2023\"},{\"company\":\"The Florentine Opera\",\"url\":\"N/A\",\"name\":\"Collaborative Pianist\",\"type\":\"other\",\"description\":\"The Collaborative Pianist is a season-long comprehensive artist-in-residence program for pianists beginning their professional careers. The Florentine Opera will announce auditions for our 2024/25 season in Fall 2023.\",\"date\":\"Fall 2023\"},{\"company\":\"The Florentine Opera\",\"url\":\"N/A\",\"name\":\"Chorus Pipeline Project\",\"type\":\"choir\",\"description\":\"Join the Florentine Opera chorus auditions and become eligible to partake in a unique pathway to a paid chorus position: the Bronzeville Boh\\u00E8me Chorus Pipeline Project\\u2014an immersive training program that offers free in-depth instruction and culminates in a paid chorus position. Selected participants will undergo comprehensive training, honing their vocal skills and stage presence under the guidance of industry professionals. The program not only paves the way for future opportunities with The Florentine Opera Chorus roster but also ensures that your dedication and talent are rewarded.\",\"date\":\"Not specified\"},{\"company\":\"The Florentine Opera\",\"url\":\"mailto:artistic@florentineopera.org?subject=Chorus%20Auditions\",\"name\":\"General and Chorus Auditions\",\"type\":\"choir\",\"description\":\"The Florentine Opera will hold open chorus auditions for experienced singers in all voice categories for the April 2024 production of Puccini\\u0027s La boh\\u00E8me under the direction of Chorus Master Dr. Benjamin Rivera. Directed by Nadja Simmonds and conducted by Florentine Opera Music Director Francesco Milioto, this production of La boh\\u00E8me will be set in Milwaukee\\u0027s historic Bronzeville neighborhood, and performed at Uihlein Hall at Marcus Performing Arts Center in Milwaukee, WI, on April 19 \\u0026 21, 2024.\",\"date\":\"June 20, 5:00-10:00pm, June 22, 5:00-10:00pm, Friday, July 7, 5:00-10:00pm\"}]}";
				//"{\"jobs\":[{\"company\":\"Hell in a Handbag Productions\",\"name\":\"Murder, ReWrote\",\"type\":\"musical\",\"description\":\"Looking for an actor for an ensemble swing role in Murder, ReWrote, a musical parody of the the classic Angela Lansbury series from 1980\\u0027s. Candidates should have sharp comic timing, sing well, and dance skills.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Myers Dinner Theatre\",\"name\":\"The Rat Pack Lounge\",\"type\":\"play\",\"description\":\"Seeking actors for the following roles in The Rat Pack Lounge: VIC CANDELINO - Down on his luck owner of Vic\\u0027s Place. Bankrupt and ready to throw in.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Opens Space Arts\",\"name\":\"Directors, Designers, Creatives, and Crew\",\"type\":\"other\",\"description\":\"Open Space Arts seeks talented individuals to be part of our transformative mission. We seek directors, designers, crew members, and creators passionate about using their artistic skills to challenge discriminatory beliefs and promote understanding within marginalized communities.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Pickle Drive-In Production\",\"name\":\"Lime Green Magazine\",\"type\":\"film\",\"description\":\"Casting Call for Lime Green Magazine, A Short Film Trailer. A Southern Gothic Gender-Queer Road Journey set in the late 80\\u0027s, early 90\\u0027s with a new original soundtrack. Production will take place in Chicago Late Summer, Early Fall 2023.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"BYOT Productions\",\"name\":\"July 2023 24-Hour Show\",\"type\":\"other\",\"description\":\"BYOT is a platform for anyone to come and create live theater with a supportive and collaborative group of talent, regardless of experience level.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Theatre Above the Law\",\"name\":\"Season Generals\",\"type\":\"play\",\"description\":\"Theatre Above the Law is holding its season generals. Season productions include Grimm: October 9-29, End Days March 1-24, 2024, Prelude to a Kiss May 3-26, 2024. All rehearsals and performances take place at The Jarvis Square Theater.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Young People\\u0027s Theatre\",\"name\":\"Junie B. Jones The Musical\",\"type\":\"musical\",\"description\":\"Following a successful inaugural season, Young People\\u0027s Theatre of Chicago kick-starts its sophomore season with the fantastically fun Junie B. Jones The Musical.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Edge of the Wood Theatre\",\"name\":\"The Minutes\",\"type\":\"play\",\"description\":\"Edge of the Wood Theatre, located in Chicago\\u0027s Edgebrook neighborhood on the northwest side, announces auditions for The Minutes by Tracy Letts on Tuesday, July 11 and Thursday, July 13 from 7-9pm. Auditions will be held in the theatre space at the Edgebrook Community Church.\",\"date\":\"Jul 11, 2023\",\"auditionEndDate\":\"Jul 13, 2023\"},{\"company\":\"GreenMan Theatre Troupe\",\"name\":\"Bye Bye Birdie\",\"type\":\"musical\",\"description\":\"GreenMan Theatre Troupe is pleased to announce auditions for its 2023 Fall Musical, Bye Bye Birdie. Seeking multi-ethnic cast of men, women and teens with fantastic singing, acting and dancing abilities to play principal and supporting roles.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Babes With Blades\",\"name\":\"The Duchess of Malfi\",\"type\":\"play\",\"description\":\"Babes With Blades Theatre Company is looking for an actor of a marginalized gender to play Antonio in our upcoming production of The Duchess of Malfi. While we are open to actors of all ethnicities and identities, we strongly encourage BIPOC actors.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Idle Muse Theatre Company\",\"name\":\"Jane: Abortion and the Underground\",\"type\":\"play\",\"description\":\"Jane: Abortion and the Underground by Paula Kamen is a docudrama about the Jane collective in the 60s and 70s who helped over 10,000 women receive illegal but safe abortions in Chicago. This production will have an intimacy designer to support the scenes where the procedure is performed.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Steel Beam Theatre\",\"name\":\"Variety Show\",\"type\":\"other\",\"description\":\"Steel Beam Theatre is soliciting actors, singers, musicians, and dancers for theatrical acts. We are seeking 8 to 10 theatrical acts such as songs, monologues, scenes, and dances.\",\"date\":\"\",\"auditionEndDate\":\"\"},{\"company\":\"Westmont Performing Arts\",\"name\":\"The Drowsy Chaperone\",\"type\":\"musical\",\"description\":\"Westmont Performing Arts Presents The Drowsy Chaperone. Auditions: Monday, June 26, 6-9pm, Thursday, June 29, 6-9pm, Sunday July 2, 1-4pm. We are also looking for help with set, costumes, lights, sound, crew and publicity. We welcome people at all levels of experience.\",\"date\":\"Jun 26, 2023\",\"auditionEndDate\":\"Jul 2, 2023\"}]}";

			var output = JsonSerializer.Deserialize<JobsArgs>(response, new JsonSerializerOptions() { PropertyNameCaseInsensitive = true });
			output.Should().NotBeNull();
		}
	}
}